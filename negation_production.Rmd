---
title             : "How do children produce negation?"
shorttitle        : "Negation Production"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  this is the abstract
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
library(devtools)
library(childesr)
library(tidyverse)
library(tm)
library(forcats)
```

# Introduction

Claim: Children start producing all types of English negation by age 18 months and by 36 months, they produce them at the rate parents do.
  types of negation in English: no, sentential (not, nt), lexical (nothing, nobody, nowhere, none, un-in-de-dis-).
  For no: higher frequency in imperatives
  For sentential negation: ...
  For lexical negatoin: ...

* How frequent are different negative forms in children's input?
  
* What is the developmental trajectory of different negative forms?
* How prevelant are different negative forms in different sentence types (imperative, declerative, interrogative)?

* Do lexical negatives develop first or sentential negatives? Could one help the other?

* What percentage of children at each age produce negation? different forms?

Study 2:
* What syntactic constructions host negative forms?
* How productive are negative morphemes?

# Literature Review

Formal and functional development of negation

# Methods

```{r}

#english_negation <- get_utterances(language = "eng", age = c(0,24), role = "Target_Child")


#count_types <- function(string){
#  n <- nlevels(as.factor(unlist(strsplit(string, " "))))
#  return(n)
#}

#count_tokens <- function(string){
#  n <- unlist(strsplit(string, " "))
#  return(length(n))
#}

#english_negation <-
#  english_negation %>%
#  filter(grepl('^no | no | no$|^not | not | not$|n\'t', gloss)) %>%
#  filter(!grepl('not yet transcribed need to fix', gloss)) %>%
#  mutate(clean_utterances = removeWords(gloss, c("xxx ?", "yyy ?", "um ?", "uh ?", "oh ?", "ah ?", "n ?"))) %>%
#  mutate(can = grepl('^can | can | can$|cannot|can\'t', clean_utterances)) %>%
#  mutate(do = grepl('^do | do | do$|don\'t', clean_utterances)) %>%
#  mutate(n_types_clean = unlist(lapply(clean_utterances, count_types))) %>%
#  mutate(n_tokens_clean = unlist(lapply(clean_utterances, count_tokens))) %>%
#  mutate(type_token_ratio = n_types_clean/n_tokens_clean)

#write.csv(english_negation, file="raw_data/eng_negation_undertwo.csv")

```

```{r}
undertwo_neg <- read.csv("raw_data/eng_negation_undertwo.csv")
```

```{r population}
undertwo_neg$speaker_id %>%
  unique() %>% length()
```

Participant information:
1. what is the distribution of words per participant?
2. what proportion of children in each monthly age bin produce negative morphemes?

```{r construction}
undertwo_neg <- undertwo_neg %>%
  mutate(condensed_p_o_s = 
           (part_of_speech %>%
              str_replace_all(c('co|qn'), 'no') %>%
              str_replace_all(c('pro:\\w*|n:prop'), 'n') %>%
              str_replace_all('neg', 'not') %>%
              str_replace_all('adv:\\w*', 'adv') %>%
              str_replace_all('det:\\w*', 'det')
             )
           )
constructions <- plyr::count(undertwo_neg$condensed_p_o_s) %>%
  arrange(desc(freq))

filtered_constructions <- constructions %>%
  filter(freq>10, x!="no", x!="no no", x!="no no no", x!="no no no no", x!="")

filtered_constructions %>%
  ggplot(aes(reorder(x, -freq), freq)) + 
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

undertwo_neg %>%
  filter(condensed_p_o_s %in% filtered_constructions$x) %>%
  # Order by mean or median? or frequency?
  group_by(condensed_p_o_s) %>%
  mutate(mean_by_construction = median(target_child_age)) %>%
  arrange(mean_by_construction) %>%
  ungroup(condensed_p_o_s) %>%
  mutate(condensed_p_o_s = fct_reorder(condensed_p_o_s, mean_by_construction)) %>%
  ggplot(mapping = aes(x =condensed_p_o_s, y =target_child_age)) +
  #geom_boxplot(color = 'red')+
  geom_jitter(size = .5, width = .2) +
  stat_summary(geom = "crossbar", width=0.65, fatten=2, color="red", fun.data = function(x){ return(c(y=median(x), ymin=median(x), ymax=median(x))) })+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#filter(undertwo_neg, condensed_p_o_s == 'no n v')$clean_utterances %>%
#unique()

# 12; and based on the graph it's late
# Even counting utterances containing 'no n v' only like 50 
# constructions %>%
  #filter(x == 'no n v')

#3495
#sum(constructions$freq)
```

|Abbreviation     | Meaning       |
|-----------------|---------------|
| n               | noun (includes pronouns and proper nouns) |
| v               | verb          |
| adj             | adjective     |
| adv             | adverb        |
| prep            | preposition   |
| det             | determiner    |
| part            | participle    |
| mod             | modal         | 


| Construction    | Examples                           | Negation Categories  |
|-----------------|------------------------------------|----------------------|
| no n            | no baby, no horsie, no juice       | Existence, Desire, Metalinguistic? |
| no no n  OOPS   | PROBLEM HERE no more stuff, *no car, no no pram, #no like doggy  |    |
| no det n        | no my turn, no a cow, no the hammer|                      |
| no adj          | no happy, no pretend, no brown     |                      |
| no adv          | no there, no up, no behind         |                      |
| no n adv        | no jacket on, no monkey there, *no lie down  |            |
| no n n          | no baby bubble, no this one, *no brush hair|              |
| no n n n        | no night night moon, no mummy this side, *no hold daddy hand |                |
| no n v          | no mail came, no mummy go, no I wanted |                  |
| no n v n        | no car go car, no comb want brush, no mummy do it |    |
| no part         | no bouncing, no eating, no hurting |                      |
| no prep n       | no in tree, no with this, *no like bubbles|               |
| no v            | no read, no pooped,  *no zipper    |                      |
| no v n          | no sit chair, no have cracker, no eat milk |              |
| not n           | not noodle, not home, not right    |                      |
| not det n       | not my car, not a cat, not a white |                      |
| not adj         | not good, not dirty, not real      |                      |
| not adv         | not today, not there, *not asleep  |                      |
| not v           | not shush, not work, not blanket   |                      |
| not v n         | not eat rocks, not have coffee, not green one|            |
| n no            | mammy no, apple no, train no       |                      |
| n not n         | pizza not pizza, pizza not apples, that not knees|        |
| n v no          | doll sit no, I take no, Joana say no|                     |
| mod             | don't, can't                       |                      |
| mod n           | can't tea, don't Mommy, didn't I   |                      |
| mod v           | don't go, doesn't work, can't catch|                      |
| mod v adv       | can't come in, don't fall down, doesn't fit here|         |
| mod v n         | don't touch that, don't fit car, can't open it|           |
| mod v n n       | don't eat skin part, (?) don't touch that book, *can't find bunny rabit  | |
| n mod           | I can't, Jane doesn't, mine didn't |                      |
| n mod v         | I don't know, they don't fit, I can't open|               |
| n mod v n       | I don't want juice, I can't find duck, cow won't go Mama| |
| n mod v prep    | I don't want to, Laura don't want to|                     |
| v no n n        | man no taste it (???)              |                      |
    
```{r}
filter(undertwo_neg, part_of_speech == "qn n")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "qn qn n")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "co n")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "co n:prop")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "mod v pro:per")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "qn pro:indef")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "mod")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "pro:sub mod")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "mod v")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "mod v pro:dem")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "pro:sub mod v")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "co v")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "pro:sub mod v pro:per")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "neg adv")$clean_utterances %>%
  unique

filter(undertwo_neg, part_of_speech == "co v n")$clean_utterances %>%
  unique

```

```{r}
# Arbitrary, judgement-based distinction; how to actually split them up?
non_sentential <- c("qn n", "qn qn n", "co n", "co n:prop", "co v", "co n:prop n n", "n co", "neg n", "neg v", "co pro:pos")
sentential <- c("pro:sub mod v pro:per", "pro:sub mod v pro:dem", "pro:sub mod v prep", "pro:sub mod v n", "pro:sub mod v", "mod v pro:per", "mod v n", "mod v adv", "neg adv", "co adv")
ns_count <- filter(undertwo_neg, part_of_speech %in% non_sentential)$clean_utterances %>%
  length()
s_count <-  filter(undertwo_neg, part_of_speech %in% sentential)$clean_utterances %>%
  length()

```

```{r}
undertwo_neg %>%
  filter(part_of_speech!="co", part_of_speech!="co co", part_of_speech!="co co co", part_of_speech!="co co co co", part_of_speech!="co co co co co", part_of_speech!="co co co co co co", part_of_speech!="") %>%
  group_by(part_of_speech) %>%
  summarise(utterances = paste(clean_utterances, collapse =","))
```

```{r}
top30 <- filter(constructions, freq>10, x!="co", x!="co co", x!="co co co", x!="co co co co", x!="")$freq %>%
  sum()

all <- filter(constructions, x!="co", x!="co co", x!="co co co", x!="co co co co", x!="")$freq %>%
  sum()

top30/all
```

Susan's Questions:
Are you sure it is a quantifier or a marker of non-existence?
Check the difference between no+N and no-more+N
how about single "no"s?

To do:
1. cluster the most frequent categories
2. look at the age distribution for the cluster (what about the distribution of age in communicative function: nonexistence, nondesire, imperative)


## Participants

## Material

## Procedure

## Data analysis

# Results

```{r}
#freqTable_bySpeaker %>%
#  filter(negative_form!="pos") %>%
#ggplot(aes(speaker,ppt)) +
#  geom_bar(stat="identity", aes(fill=negative_form)) +
#  theme_classic()
```

# Discussion


\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
