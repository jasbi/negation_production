---
title: 'Negation Production Processing Script: Study 2'
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/Documents/LDS/Production_Study/negation_production")
library(tidyverse)
library(magrittr)
library(feather)
library(binom)
library(childesr)
library(lubridate)
library(tm)
```


```{r, include= FALSE}

# english_negation <- get_utterances(language = "eng", age = c(0,24), role = "Target_Child")
# 
# 
# count_types <- function(string){
#  n <- nlevels(as.factor(unlist(strsplit(string, " "))))
#  return(n)
# }
# 
# count_tokens <- function(string){
#  n <- unlist(strsplit(string, " "))
#  return(length(n))
# }
# 
# english_negation <-
#  english_negation %>%
#  filter(grepl('^no | no | no$|^not | not | not$|n\'t', gloss)) %>%
#  filter(!grepl('not yet transcribed need to fix', gloss)) %>%
#  mutate(clean_utterances = removeWords(gloss, c("xxx ?", "yyy ?", "um ?", "uh ?", "ah ?"))) %>%
#  mutate(can = grepl('^can | can | can$|cannot|can\'t', clean_utterances)) %>%
#  mutate(do = grepl('^do | do | do$|don\'t|does|doesn\'t', clean_utterances)) %>%
#  mutate(want = grepl('^want | want | want$', clean_utterances))%>%
#  mutate(n_types_clean = unlist(lapply(clean_utterances, count_types))) %>%
#  mutate(n_tokens_clean = unlist(lapply(clean_utterances, count_tokens))) %>%
#  mutate(type_token_ratio = n_types_clean/n_tokens_clean)
# 
# 
# write.csv(english_negation, file="raw_data/eng_negation_undertwo.csv")

```

```{r cleanup, include=FALSE}
undertwo_neg <- read.csv("raw_data/eng_negation_undertwo.csv")

# Modifications to part_of_speech column
condense_pos <- function (gloss, pos) 
{
  # Replace POS with 'no' where relevant
  if (pos == "") {return(pos)}
  no_list = list()
  gloss_list = strsplit(gloss," ")
  for (g in 1:length(gloss_list[[1]])) {
    if (gloss_list[[1]][g] == "no"){
      no_list <- append(unlist(no_list), g)
    }
  }
  pos_list <- unlist(strsplit(pos, " "))
  pos_list[unlist(no_list)] <- "no"
  result <- removeWords(paste(pos_list, collapse = " "), "NA")
  
  # Condense POS to major categories
  result <- result %>%
    str_replace_all('pro:\\w*|n:prop', 'n') %>% 
    str_replace_all('neg', 'not') %>% 
    str_replace_all('adv:\\w*', 'adv') %>% 
    str_replace_all('det:\\w*', 'det')
  
  
  # Condense repeated 'no'
  result <- gsub(' (no )+', ' no ', result) 
  result <- gsub(' (no ?)+$', ' no', result)
  result <- gsub('^(no )+', 'no ', result)
  result <- gsub('^(no ?)+$', 'no', result)
  
  return (result)
}


undertwo_neg$clean_utterances <- as.character(undertwo_neg$clean_utterances)
undertwo_neg$part_of_speech <- as.character(undertwo_neg$part_of_speech)

# Add condensed part of speech column to reflect simplifications
undertwo_neg <- undertwo_neg %>%
  mutate(condensed_p_o_s = 
           mapply(condense_pos, clean_utterances, part_of_speech))

constructions <- plyr::count(undertwo_neg$condensed_p_o_s) %>%
  arrange(desc(freq))

filtered_constructions <- constructions %>%
  filter(freq>10, x!="no", x!="")

```

``` {r fix miscodes, include=FALSE}
replacements <- 
  list(
    list("no v", "no tickle", "no bite", "no push", "no works", "no hold", "no play", "no touch", "no look", "no help", "no see"),
    list("no v n", "no no like Winnie+Pooh", "no like sweet+corn", "no want din+dins", "no go bathroom", "no touch Lastname",
         "no pop weasel", "no hold it", "no hug baby", "no brush hair", "no pinch that","no ride horsie", "no stop it",
         "no help me", "no spin it", "no play toys"), 
    list("co no co", "quack_quack no peep_peep_peep"),
    list("n no", "horsie no"), 
    list("n mod v prep", "hh I can’t sing with"), 
    list("n mod v n", "I can’t go living+room"), 
    list("no n v", "no Mommy Humm", "no mummy sneeze", "no everybody fall", "no hair wash"), 
    list("no", "no"), 
    list("not adj", "not right", "not asleep"), 
    list("no n n v", "no Mommy baby seep"),
    list("no n v n", "no Abi play toys", "no everybody play toys", "no mummy check nappie", "no Papa tie it"),
    list("no v n n", "no hold daddy hand", "no dump Baura puzzle", "no spin it mom", "no pinch that monkey"), 
    list("mod v n adv", "can’t put him back"), 
    list("no n prep n", "no no piece a paper"), 
    list("not det n n", "not a cat station+cat"),
    list("not adj n", "not green one"), 
    list("not n", "not baby", "not lunch", "not diaper", "not blanket"), 
    list("n no v n", "man no taste it")
)
  

fix <- function(df, replacements) 
{
  for (i in 1:length(replacements))
  {
    for (j in 2:length(replacements[[i]]))
    {
      df$condensed_p_o_s[df$clean_utterances == replacements[[i]][[j]]] <- replacements[[i]][[1]]
    }
  }
  return(df)
}

undertwo_neg <- fix(undertwo_neg, replacements)
```

Total # of utterances: `r nrow(undertwo_neg)`

|Abbreviation     | Meaning       |
|-----------------|---------------|
| adj             | adjective     |
| adv             | adverb        |
| co              | ???           |
| det             | determiner    |
| mod             | modal         | 
| n               | noun (includes pronouns and proper nouns) |
| part            | participle    |
| prep            | preposition   |
| qn              | quantifier    |
| v               | verb          |


| Construction    | Frequency | Examples                           | 
|-----------------|:-----------:|------------------------------------|
| no n            | `r filter(undertwo_neg, condensed_p_o_s == "no n")$clean_utterances %>% length()` | no baby, no horsie, no juice  | 
| co no           | `r filter(undertwo_neg, condensed_p_o_s == "co no")$clean_utterances %>% length()`| oh no, okay no, yeah no |
| mod v n         | `r filter(undertwo_neg, condensed_p_o_s == "mod v n")$clean_utterances %>% length()` | don't touch that, don't fit car, can't open it|           
| n mod v n       | `r filter(undertwo_neg, condensed_p_o_s == "n mod v n")$clean_utterances %>% length()` | I don't want juice, I can't find duck, cow won't go Mama| 
| mod             | `r filter(undertwo_neg, condensed_p_o_s == "mod")$clean_utterances %>% length()` | don't, can't                       |                      
| n mod v         | `r filter(undertwo_neg, condensed_p_o_s == "n mod v")$clean_utterances %>% length()` | I don't know, they don't fit, I can't open|               
| mod v           | `r filter(undertwo_neg, condensed_p_o_s == "mod v")$clean_utterances %>% length()` | don't go, doesn't work, can't catch|                      
| no n n          | `r filter(undertwo_neg, condensed_p_o_s == "no n n")$clean_utterances %>% length()` | no baby bubble, no this one, *no brush hair|              
| n mod           | `r filter(undertwo_neg, condensed_p_o_s == "n mod")$clean_utterances %>% length()` | I can't, Jane doesn't, mine didn't |                      
| no qn n         | `r filter(undertwo_neg, condensed_p_o_s == "no qn n")$clean_utterances %>% length()` | no more stuff, *no car, no no pram, no like doggy  |    
| no co           | `r filter(undertwo_neg, condensed_p_o_s == "no co")$clean_utterances %>% length()` | no no, no yes, no look (??), no thanks |
| not n           | `r filter(undertwo_neg, condensed_p_o_s == "not n")$clean_utterances %>% length()` | not noodle, not home, not right    |                      
| no v            | `r filter(undertwo_neg, condensed_p_o_s == "no v")$clean_utterances %>% length()` | no read, no pooped,  *no zipper    |                      
| no v n          | `r filter(undertwo_neg, condensed_p_o_s == "no v n")$clean_utterances %>% length()` | no sit chair, no have cracker, no eat milk |              
| not adv         | `r filter(undertwo_neg, condensed_p_o_s == "not adv")$clean_utterances %>% length()` | not today, not there, *not asleep  |                      
| no n n n        | `r filter(undertwo_neg, condensed_p_o_s == "no n n n")$clean_utterances %>% length()` | no night night moon, no mummy this side, *no hold daddy hand  |
| no adv          | `r filter(undertwo_neg, condensed_p_o_s == "no adv")$clean_utterances %>% length()` | no there, no up, no behind         |                      
| n no            | `r filter(undertwo_neg, condensed_p_o_s == "n no")$clean_utterances %>% length()` | mammy no, apple no, train no       |                      
| mod v n n       | `r filter(undertwo_neg, condensed_p_o_s == "mod v n n")$clean_utterances %>% length()` | don't eat skin part, (?) don't touch that book, *can't find bunny rabit  | 
| no prep n       | `r filter(undertwo_neg, condensed_p_o_s == "no prep n")$clean_utterances %>% length()` | no in tree, no with this, *no like bubbles|               
| n mod v prep    | `r filter(undertwo_neg, condensed_p_o_s == "n mod v prep")$clean_utterances %>% length()` | I don't want to, Laura don't want to|                     
| n v no          | `r filter(undertwo_neg, condensed_p_o_s == "n v no")$clean_utterances %>% length()` | doll sit no, I take no, Joana say no|                     
| no n v n        | `r filter(undertwo_neg, condensed_p_o_s == "no n v n")$clean_utterances %>% length()` | no car go car, no comb want brush, no mummy do it |       
| mod n           | `r filter(undertwo_neg, condensed_p_o_s == "mod n")$clean_utterances %>% length()` | can't tea, don't Mommy, didn't I   |                      
| not adj         | `r filter(undertwo_neg, condensed_p_o_s == "not adj")$clean_utterances %>% length()` | not good, not dirty, not real      |                      
| not det n       | `r filter(undertwo_neg, condensed_p_o_s == "not det n")$clean_utterances %>% length()` | not my car, not a cat, not a white |                      
| not v n         | `r filter(undertwo_neg, condensed_p_o_s == "not v n")$clean_utterances %>% length()` | not eat rocks, not have coffee, not green one|            
| no det n        | `r filter(undertwo_neg, condensed_p_o_s == "no det n")$clean_utterances %>% length()` | no my turn, no a cow, no the hammer|                    
| no n v          | `r filter(undertwo_neg, condensed_p_o_s == "no n v")$clean_utterances %>% length()` | no mail came, no mummy go, no I wanted|    
| not v           | `r filter(undertwo_neg, condensed_p_o_s == "not v")$clean_utterances %>% length()` | not shush, not work, not blanket   |                      
| mod v adv       | `r filter(undertwo_neg, condensed_p_o_s == "mod v adv")$clean_utterances %>% length()` | can't come in, don't fall down, doesn't fit here|         
| no n adv        | `r filter(undertwo_neg, condensed_p_o_s == "no n adv")$clean_utterances %>% length()` | no jacket on, no monkey there, *no lie down  |            
| v no n n        | `r filter(undertwo_neg, condensed_p_o_s == "v no n n")$clean_utterances %>% length()` | man no taste it (???)              |  
| n no n          | `r filter(undertwo_neg, condensed_p_o_s == "n no n")$clean_utterances %>% length()` | straws no straws, Mommie no mail, there's no towel  |  
| n not n         | `r filter(undertwo_neg, condensed_p_o_s == "n not n")$clean_utterances %>% length()` | pizza not pizza, pizza not apples, that not knees|        
| no adj          | `r filter(undertwo_neg, condensed_p_o_s == "no adj")$clean_utterances %>% length()` | no happy, no pretend, no brown     |                      
| no part         | `r filter(undertwo_neg, condensed_p_o_s == "no part")$clean_utterances %>% length()` | no bouncing, no eating, no hurting |  



| Category           | Frequency  | Examples                                              |
|-----------------------------|:----------:|-------------------------------------------------------|
| Do                 |  `r length(filter(undertwo_neg, do)$clean_utterances)`   | don't like it, I don't feel good, no do it Mummy|
| Ability (can)      |  `r length(filter(undertwo_neg, can)$clean_utterances)`  | I can't find a blankie, can't eat, no no I can not do |
| Desire (want)      |  `r length(filter(undertwo_neg, want)$clean_utterances)` | Don't want to, no comb want brush, no want the baby|
| Don't want         |  `r filter(undertwo_neg, grepl('don\'t want', clean_utterances))$clean_utterances %>% length()`| I don't want juice, don't want it, Laura don't want to|
| Don't know         |   `r filter(undertwo_neg, grepl('don\'t know', clean_utterances))$clean_utterances %>% length()` | I don't know, I don't know name of them, you don't know how zip zip up |
| Don't like         |   `r filter(undertwo_neg, grepl('don\'t like', clean_utterances))$clean_utterances %>% length()` | I don't like it, don't like toast, I don't like|
| No [simple thing]  |  `r filter(undertwo_neg, grepl('^no [a-z]+$', condensed_p_o_s) & condensed_p_o_s != "no no")$clean_utterances %>% length()`| no go, no stupid, no now, no baby|
| No more            |  `r filter(undertwo_neg, grepl('( |^)no more( |$)', clean_utterances))$clean_utterances %>% length()` | no more, no more corn, there's no more time |
| Not [simple thing] |  `r filter(undertwo_neg, grepl('^not [a-z]+$', condensed_p_o_s))$clean_utterances %>% length()`| not bad, not write, not quite|
| Presentential (Optimistic) | `r filter(undertwo_neg, grepl('^no n v ?.*', condensed_p_o_s))$clean_utterances %>% length()` | no daddy eat, no eat lunch, no in tree, no Toto here|
| Presentential (Pessimistic)| `r filter(undertwo_neg, condensed_p_o_s %in% c("no n v", "no n v n"))$clean_utterances %>% length()` | no Mommy read, no I wanted, no baby bite me, no water go|


``` {r}
#filters for 'no [anything], excluding repeated 'no'; 1183 utterances (33.8%)
filter(undertwo_neg, grepl('^no .*', condensed_p_o_s) & !grepl('^(no ?)+$', condensed_p_o_s))$clean_utterances %>% length()

#filters for 'no n [anything]', excluding repeated 'no'; 236 utterances (6.75%)
filter(undertwo_neg, grepl('^no n.*', condensed_p_o_s) & !grepl('^(no ?)+$', condensed_p_o_s))$clean_utterances %>% length()

# filters for 'do not'; 22 utterances (!!!!) vs. 602 'don't' utterances
filter(undertwo_neg, grepl('( |^)do not( |$)', clean_utterances))$clean_utterances
# Same with 'can not'; 2 utterances vs 208 'can't' utterances


```




