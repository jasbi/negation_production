---
title: 'Negation Production Processing Script: Study 2'
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = "~/Documents/LDS/Production_Study/negation_production")
library(tidyverse)
library(magrittr)
library(feather)
library(binom)
library(childesr)
library(lubridate)
library(tm)
library(knitr)
library(kableExtra)
library(reshape)
library(reshape2)
library(RColorBrewer)
library(pals)
library(gridExtra)

age_limits <- c(0, 36)
```


```{r get child data, include= FALSE}
# child_utterances <- get_utterances(language = "eng", age = age_limits, role = "Target_Child")
# 
# count_types <- function(string){
#  n <- nlevels(as.factor(unlist(strsplit(string, " "))))
#  return(n)
# }
# 
# count_tokens <- function(string){
#  n <- unlist(strsplit(string, " "))
#  return(length(n))
# }
# 
# child_utterances <- child_utterances %>%
#  mutate(clean_utterances = removeWords(gloss, c("xxx ?", "yyy ?", "um ?", "uh ?", "ah ?"))) %>%
#  filter(!grepl('not yet transcribed need to fix', gloss)) %>%
#  filter(!grepl('^ ?$', part_of_speech)) %>%
#  filter(!grepl('^ ?$',clean_utterances)) %>%
#  mutate(n_types_clean = unlist(lapply(clean_utterances, count_types))) %>%
#  mutate(n_tokens_clean = unlist(lapply(clean_utterances, count_tokens))) %>%
#  mutate(type_token_ratio = n_types_clean/n_tokens_clean)
# 
#write.csv(child_utterances, file="raw_data/eng_child_utterances.csv")

child_utterances <- read.csv("raw_data/eng_child_utterances.csv")
# 
# 
# child_negation <-
#  child_utterances %>%
#  filter(grepl('( |^)no( |$)|( |^)not( |$)|( |^)[a-z]+n\'t( |$)', clean_utterances)) %>%
#  mutate(can = grepl('^can | can | can$|cannot|can\'t', clean_utterances)) %>%
#  mutate(do = grepl('( |^)do( |$)|don\'t|( |^)does( |$)|doesn\'t|( |^)did( |$)|didn\'t', clean_utterances)) %>%
#  mutate(want = grepl('^want | want | want$', clean_utterances))
# 
# # Function removing repeated 'no'
# fix_nos <- function(x)
# {
#   result <- gsub(' (no )+', ' no ', x)
#   result <- gsub(' (no ?)+$', ' no', result)
#   result <- gsub('^ ?(no )+', 'no ', result)
#   result <- gsub('^ ?(no ?)+$', 'no', result)
#   return(result)
# }
# 
# # Modifications to part_of_speech column
# condense_pos <- function (gloss, pos)
# {
#   gloss = fix_nos(gloss)
#   # Replace POS with 'no' where relevant
#   if (pos == "") {return(pos)}
#   no_list = list()
#   gloss_list = strsplit(gloss," ")
#   pos_list <- unlist(strsplit(pos, " "))
#   for (g in 1:length(gloss_list[[1]])) {
#     if (gloss_list[[1]][g] == "no"){
#       pos_list[g] <- paste("no", pos_list[g], sep = ":")
#     }
#   }
#   result <- removeWords(paste(pos_list, collapse = " "), "NA")
# 
#   # Condense POS to major categories
#   result <- result %>%
#     str_replace_all('pro:\\w*|n:\\w*', 'n') %>%
#     str_replace_all('neg', 'not') %>%
#     str_replace_all('adv:\\w*', 'adv') %>%
#     str_replace_all('det:\\w*', 'det') %>%
#     str_replace_all('mod:\\w*', 'mod')
# 
#   return (result)
# }
# 
# child_negation$clean_utterances <- as.character(child_negation$clean_utterances)
# child_negation$part_of_speech <- as.character(child_negation$part_of_speech)
# 
# # Add condensed part of speech column to reflect simplifications
# child_negation <- child_negation %>%
#   mutate(condensed_p_o_s = mapply(condense_pos, clean_utterances, part_of_speech)) %>%
#   mutate(clean_utterances = lapply(clean_utterances, fix_nos) %>% unlist()) %>%
#   # remove single-word negations
#   filter(!grepl('^no$|^not$|^[a-z]*n\'t$', condensed_p_o_s))
# 
# # Remove utterances that don't line up with their pos
# check_lengths <- function(utterance, pos)
# {
#   return(length(strsplit(utterance, " ")[[1]]) == length(strsplit(pos, " ")[[1]]))
# }
# child_negation<- child_negation %>%
#   filter(mapply(check_lengths, condensed_p_o_s, clean_utterances))
# 
# 
# # Fix miscodes
# replacements <-
#   list(
#     # Nouns coded incorrectly
#     list("n no", "horsie no"),
#     list("not n", "not baby", "not lunch", "not diaper", "not blanket"),
#     list("n mod v n", "I canâ€™t go living+room"),
#     # Verbs coded incorrectly
#     list("no v", "no tickle", "no bite", "no push", "no works", "no hold", "no play", "no touch", "no look", "no help", "no see"),
#     list("no v n", "no like sweet+corn", "no touch Lastname",
#          "no pop weasel", "no hold it", "no hug baby", "no brush hair", "no pinch that","no ride horsie", "no stop it",
#          "no help me", "no spin it", "no play toys"),
#     list("no n v", "no Mommy Humm", "no mummy sneeze", "no everybody fall", "no hair wash"),
#     list("no n n v", "no Mommy baby seep"),
#     list("no n v n", "no Abi play toys", "no everybody play toys", "no mummy check nappie", "no Papa tie it"),
#     list("no v n n", "no hold daddy hand", "no dump Baura puzzle", "no spin it mom", "no pinch that monkey"),
#     list("n no v n", "man no taste it")
#   )
# 
# 
# # Insert replacements
# fix <- function(df, replacements)
# {
#   for (i in 1:length(replacements))
#   {
#     for (j in 2:length(replacements[[i]]))
#     {
#       df$condensed_p_o_s[df$clean_utterances == replacements[[i]][[j]]] <- replacements[[i]][[1]]
#     }
#   }
#   return(df)
# }
# 
# child_negation <- fix(child_negation, replacements)
# 
# write.csv(child_negation, file="raw_data/eng_child_negation.csv")

child_negation <- read.csv("raw_data/eng_child_negation.csv")

child_negation$condensed_p_o_s <- as.character(child_negation$condensed_p_o_s)
child_negation$clean_utterances <- as.character(child_negation$clean_utterances)
```

```{r get parent data, echo=FALSE}
#parent_utterances <- get_utterances(language = "eng", age = age_limits, role = c("Mother", "Father"))
#
# parent_utterances <- parent_utterances %>%
#  mutate(clean_utterances = removeWords(gloss, c("xxx ?", "yyy ?", "um ?", "uh ?", "ah ?"))) %>%
#  filter(!grepl('not yet transcribed need to fix', gloss)) %>%
#  filter(!grepl('^ ?$', part_of_speech))%>%
#  filter(!grepl('^ ?$',clean_utterances)) %>%
#  mutate(n_types_clean = unlist(lapply(clean_utterances, count_types))) %>%
#  mutate(n_tokens_clean = unlist(lapply(clean_utterances, count_tokens))) %>%
#  mutate(type_token_ratio = n_types_clean/n_tokens_clean)
# 
# write.csv(parent_utterances, file="raw_data/eng_parent_utterances.csv")
# 
parent_utterances <- read_csv("raw_data/eng_parent_utterances.csv")
# parent_negation <-
#  parent_utterances %>%
#  filter(grepl('( |^)no( |$)|( |^)not( |$)|( |^)[a-z]+n\'t( |$)', clean_utterances)) %>%
#  mutate(can = grepl('^can | can | can$|cannot|can\'t', clean_utterances)) %>%
#  mutate(do = grepl('( |^)do( |$)|don\'t|( |^)does( |$)|doesn\'t|( |^)did( |$)|didn\'t', clean_utterances)) %>%
#  mutate(want = grepl('^want | want | want$', clean_utterances))
# 
# parent_negation$clean_utterances <- as.character(parent_negation$clean_utterances)
# parent_negation$part_of_speech <- as.character(parent_negation$part_of_speech)
# 
# # Add condensed part of speech column to reflect simplifications
# parent_negation <- parent_negation %>%
#   mutate(condensed_p_o_s = mapply(condense_pos, clean_utterances, part_of_speech)) %>%
#   mutate(condensed_p_o_s = lapply(condensed_p_o_s, fix_nos) %>% unlist()) %>%
#   mutate(clean_utterances = lapply(clean_utterances, fix_nos) %>% unlist()) %>%
#   # remove single-word negations
#   filter(!grepl('^no:\\w*$|^not$|^[a-z]*n\'t$', condensed_p_o_s))
# 
# # Remove utterances that don't line up with their pos
# parent_negation<- parent_negation %>%
#   filter(mapply(check_lengths, condensed_p_o_s, clean_utterances))
# 
# write.csv(parent_negation, file="raw_data/eng_parent_negation.csv", row.names = FALSE)

parent_negation <- read.csv("raw_data/eng_parent_negation.csv")

parent_negation$condensed_p_o_s <- as.character(parent_negation$condensed_p_o_s)
parent_negation$clean_utterances <- as.character(parent_negation$clean_utterances)
```


Total # of utterances: `r nrow(child_negation)`

|Abbreviation     | Meaning       |
|-----------------|---------------|
| adj             | adjective     |
| adv             | adverb        |
| co              | ???           |
| det             | determiner    |
| mod             | modal         | 
| n               | noun (includes pronouns and proper nouns) |
| part            | participle    |
| prep            | preposition   |
| qn              | quantifier    |
| v               | verb          |


```{r construction tables}
# Uh why doesn't this work anymore?
# constructions <- count(child_negation$condensed_p_o_s) %>%
#   arrange(desc(freq))
# 
# filtered_constructions <- constructions %>%
#   filter(freq>10, x!="")

table1 <- data.frame(
  "Construction" = c( "no n" ,  "co no" , "mod v n" , "n mod v n" , "n mod v" , "mod v", "n mod", "no qn n" , "no v" , "no n n", "no v n" , "not n",
                      "no n v n" , "not adv" ,"no adv" , "n no" , "no co" , "mod v n n",  "no n v", "no prep n" , "not adj", "n mod v prep" , "n v no" ,  "mod n" ,
                      "n no v n" ,  "not det n" , "not v n" ,  "no det n" ,  "mod v adv" ,  "no n adv" , "n no n" , "n not n"  , "no adj" ,  "no part" ), 
  "Examples" = c("no baby, no horsie, no juice", 
                 "oh no, okay no, yeah no", 
                 "don't touch that, don't fit car, can't open it", 
                 "I don't want juice, I can't find duck, cow won't go Mama", 
                 "I don't know, they don't fit, I can't open", 
                 "don't go, doesn't work, can't catch", 
                 "I can't, Jane doesn't, mine didn't", 
                 "no more stuff, no other pennies, no like doggy", 
                 "no read, no pooped, no want", 
                 "no baby bubble, no this one, no you pencil", 
                 "no sit chair, no have cracker, no eat milk", 
                 "not noodle, not home, not Toffer's", 
                 "no car go car, no comb want brush, no mummy do it", 
                 "not today, not there, not yet", 
                 "no there, no up, no behind", 
                 "mammy no, apple no, train no", 
                 "no no, no yes, no thanks", 
                 "don't eat skin part, don't touch that book, can't find bunny rabit", 
                 "no mail came, no mummy go, no I wanted", 
                 "no in tree, no with this, no like bubbles", 
                 "not good, not dirty, not real", 
                 "I don't want to, Laura don't want to", 
                  "doll sit no, I take no, Joana say no", 
                 "can't tea, don't Mommy, didn't I", 
                  "man no taste it, I no do it", 
                 "not my car, not a cat, not a white", 
                 "not eat rocks, not have coffee, not green one", 
                 "no my turn, no a cow, no the hammer", 
                 "can't come in, don't fall down, doesn't fit here", 
                 "no jacket on, no monkey there, no lie down", 
                 "straws no straws, Mommie no mail, there's no towel", 
                 "pizza not pizza, pizza not apples, that not knees", 
                 "no happy, no pretend, no brown", 
                 "no bouncing, no eating, no hurting")
)

freq <- function(pos) 
{
  filter(child_negation, condensed_p_o_s == pos)$clean_utterances %>% length()
}

table1 <- table1 %>%
  mutate(Frequency = sapply(as.character(Construction), freq))

table1 <- table1[order(-table1$Frequency),]

kable(table1[,c(1, 3, 2)]) %>%
  kable_styling(font_size = 12) %>%
  column_spec(4, width = "20em")

table2 <- data.frame("Category" = c("Can", "Want", "Do","Don't", "Don't want", "Don't know", "Don't like", "No _", "No more", "Not _", "Presentential \`No\'", "Pre-VP \`No\'", "Sentence-internal \`No\'", "Presentential \`Not\'", "Pre-VP \`Not\'", "Sentence-internal \'Not\'"), 
                     "Frequency" = c(length(filter(child_negation, can)$clean_utterances), 
                                     length(filter(child_negation, want)$clean_utterances),
                                     length(filter(child_negation, do)$clean_utterances), 
                                     filter(child_negation, grepl('don\'t', clean_utterances))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('don\'t want', clean_utterances))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('don\'t know', clean_utterances))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('don\'t like', clean_utterances))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^no [a-z]+$', condensed_p_o_s) & condensed_p_o_s != "no no")$clean_utterances %>% length(),
                                     filter(child_negation, grepl('( |^)no more( |$)', clean_utterances))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^not [a-z]+$', condensed_p_o_s))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^no n v ?.*', condensed_p_o_s))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^no v ?.*', condensed_p_o_s))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^n no v ?.*', condensed_p_o_s))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^not n v ?.*', condensed_p_o_s))$clean_utterances %>% length(),
                                     filter(child_negation, grepl('^not v ?.*', condensed_p_o_s))$clean_utterances %>% length(), 
                                     filter(child_negation, grepl('^n not v ?.*', condensed_p_o_s))$clean_utterances %>% length()), 
                     "Examples" = c("I can't find a blankie, can't eat, no no I can not do", 
                                    "Don't want to, no comb want brush, no want the baby",
                                    "don't like it, I don't feel good, no do it Mummy", 
                                    "don't like it, no don't, I don't know",
                                    "I don't want juice, don't want it, Laura don't want to",
                                    "I don't know, I don't know name of them, you don't know how zip zip up",
                                    "I don't like it, don't like toast, I don't like",
                                    "no go, no stupid, no now, no baby",
                                    "no more, no more corn, there's no more time",
                                    "not bad, not write, not quite",
                                    "no Mommy read, no baby bite me, no you wait there for me", 
                                    "no have black, no give me that, no bite",
                                    "man no taste it, I no eat",
                                    "not Fraser read it, not that keys",
                                    "Not shush, not write this book, not eat rocks",
                                    "cat not mother, that not fit, I not like it too"))

kable(table2, "latex") %>%
  kable_styling(font_size = 12) %>%
  #pack_rows("Don't", 4, 6); makes a header for rows 4-6
  add_indent(c(4, 5, 6, 7)) %>%
  row_spec(3, bold = T) %>%
  column_spec(3, width = "20em")

```


``` {r, include=FALSE}
#filters for 'no [anything], excluding repeated 'no'; 1183 utterances (33.8%)
filter(child_negation, grepl('^no .*', condensed_p_o_s) & !grepl('^(no ?)+$', condensed_p_o_s))$clean_utterances %>% length()

#filters for 'no n [anything]', excluding repeated 'no'; 236 utterances (6.75%)
filter(child_negation, grepl('^no n.*', condensed_p_o_s) & !grepl('^(no ?)+$', condensed_p_o_s))$clean_utterances %>% length()

# filters for 'do not'; 22 utterances (!!!!) vs. 602 'don't' utterances
filter(child_negation, grepl('( |^)do not( |$)', clean_utterances))$clean_utterances
# Same with 'can not'; 2 utterances vs 208 'can't' utterances


```

```{r child utterance breakdown, echo=FALSE}
# Bin utterances by month
bin_age <- function(age)
{
  x = floor(age)
  paste(formatC(x, width=2, flag="0"), formatC(x+1, width=2, flag="0"), sep = "-")
}

neg_tag <- function(gloss)
{
  neg <- list()
  if(grepl('(^| )no( |$)', gloss)) {neg = append(unlist(neg), "no")}
  if(grepl('(^| )not( |$)', gloss)) {neg = append(unlist(neg), "not")}
  if(grepl('(^| )[a-z]*n\'t( |$)', gloss)) {neg = append(unlist(neg), "nt")}
  if(length(neg) == 0){return(list("no_negation")[[1]])}
  else {return(neg)}
}


child_utterances <- child_utterances %>%
  mutate(bin = bin_age(target_child_age)) %>%
  mutate(neg = mapply(neg_tag, gloss))

child_utterances <- child_utterances %>%
  mutate(n_tokens_clean = factor(n_tokens_clean, levels = append(as.character(1:4), c(">4"))))

child_utterances$n_tokens_clean[is.na(child_utterances$n_tokens_clean)] <- ">4"

ggplot(child_utterances %>% filter(target_child_age >= 12.), aes(bin, fill = n_tokens_clean))+
  geom_bar() +
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))
  
ggplot(child_utterances %>% filter(neg == "no_negation") %>% filter(target_child_age >= 12.), aes(bin, fill = n_tokens_clean))+
  geom_bar() +
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD Non-negative Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))

ggplot(filter(child_utterances, neg != "no_negation"), aes(bin, fill = n_tokens_clean))+
  geom_bar() +
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD Negative Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))

ggplot(child_utterances %>% filter(target_child_age >= 12.), aes(bin, fill = n_tokens_clean))+
  geom_bar(position = "fill") +
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))
  
ggplot(child_utterances %>% filter(neg == "no_negation") %>% filter(target_child_age >= 12.), aes(bin, fill = n_tokens_clean))+
  geom_bar(position = "fill") +
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD Non-negative Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))

ggplot(filter(child_utterances, neg != "no_negation"), aes(bin,fill = n_tokens_clean))+
  geom_bar(position = "fill") +
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD Negative Utterance Length")+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Number of Words") +
  scale_fill_manual(values=as.vector(alphabet2()))+ 
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))
  
  
# Plot negation as a proportion of utterances; this isn't a very good graph
# class(child_utterances$neg) = "character"
# ggplot(child_utterances, aes(bin, fill = neg))  +
#   geom_bar() +
#   theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))

```
`r "a;lsdjf "`

```{r child negation breakdown, echo=FALSE}

child_negation <- child_negation %>% 
  mutate(bin = bin_age(target_child_age))

# Count frequency of each negation type by utterance
# Right now I'm counting the total number; i might consider just checking if its present in the utterance to eliminate repetitions
negs <- child_negation %>%
  mutate(no_co = str_count(condensed_p_o_s, '( |^)no:co( |$)')) %>%
  mutate(no_qn = str_count(condensed_p_o_s, '( |^)no:qn( |$)')) %>%
  mutate(not = str_count(clean_utterances, '( |^)not( |$)')) %>%
  mutate(nt = str_count(clean_utterances, '( |^)[a-z]*n\'t( |$)')) %>%
  mutate(sum = no_co + no_qn + not + nt) 

negs <- negs[order(negs$bin),]

# Sum negation types by bin
neg_sums <- data.frame("Bin" = unique(negs$bin)) %>%
  # Count the number of times a negative is uttered in each bin
  mutate(Neg_Count = tally(group_by(negs, bin), sum)$n) %>%
  mutate(no_co = tally(group_by(negs, bin), no_co)$n) %>%
  mutate(no_qn = tally(group_by(negs, bin), no_qn)$n) %>%
  mutate(not = tally(group_by(negs, bin), not)$n) %>%
  mutate(nt = tally(group_by(negs, bin), nt)$n)


# Consolidate data for graphing
neg_sums_melted <- neg_sums%>%subset(select = -Neg_Count) %>%melt(id.vars = "Bin")

ggplot(mapping = aes(Bin, value, fill = variable ))+
  geom_bar(data = neg_sums_melted, stat = "identity")+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD Negation Type: All Multi-word Negative Uttera")+
  scale_fill_brewer(palette="Paired")+
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1)) 

ggplot(mapping = aes(Bin, value, fill = variable ))+
  geom_bar(data = neg_sums_melted, stat = "identity", position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD Negation Type: All Multi-word Negative Uttera")+
  scale_fill_brewer(palette="Paired")+
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1)) 

```


```{r parent negation breakdown, echo=FALSE}

parent_negation <- parent_negation %>% 
  mutate(bin = bin_age(target_child_age)) %>%
  filter(target_child_age >= 13 & target_child_age <= age_limits[[2]])

# Count frequency of each negation type by utterance
# Right now I'm counting the total number; i might consider just checking if its present in the utterance to eliminate repetitions
negs <- parent_negation %>%
  mutate(no_co = str_count(condensed_p_o_s, '( |^)no:co( |$)')) %>%
  mutate(no_qn = str_count(condensed_p_o_s, '( |^)no:qn( |$)')) %>%
  mutate(not = str_count(clean_utterances, '( |^)not( |$)')) %>%
  mutate(nt = str_count(clean_utterances, '( |^)[a-z]*n\'t( |$)')) %>%
  mutate(sum = no_co + no_qn + not + nt) 

negs <- negs[order(negs$bin),]

# Sum negation types by bin
neg_sums <- data.frame("Bin" = unique(negs$bin)) %>%
  # Count the number of times a negative is uttered in each bin
  mutate(Neg_Count = tally(group_by(negs, bin), sum)$n) %>%
  mutate(no_co = tally(group_by(negs, bin), no_co)$n) %>%
  mutate(no_qn = tally(group_by(negs, bin), no_qn)$n) %>%
  mutate(not = tally(group_by(negs, bin), not)$n) %>%
  mutate(nt = tally(group_by(negs, bin), nt)$n)

# Consolidate data for graphing
neg_sums_melted <- neg_sums%>%subset(select = -Neg_Count) %>%melt(id.vars = "Bin")

ggplot(mapping = aes(Bin, value, fill = variable ))+
  geom_bar(data = neg_sums_melted, stat = "identity")+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT Negation Type: All Multi-word Negative Uttera")+
  scale_fill_brewer(palette="Paired")+
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1)) 

ggplot(mapping = aes(Bin, value, fill = variable ))+
  geom_bar(data = neg_sums_melted, stat = "identity", position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT Negation Type: All Multi-word Negative Uttera")+
  scale_fill_brewer(palette="Paired")+
  theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 70, vjust = 1, hjust=1)) 

```

```{r child no:qn Environment, echo=FALSE}
# No:qn Environment
no_qn_tag <- function(pos) 
{
  pos_list = unlist(strsplit(pos, " "))
  
  n_list = grep("^no:qn$", pos_list)
  
  out = pos_list[n_list+1]
  out = out[!is.na(out)]
  return(out)
}


no_qns <- child_negation %>%
  filter(grepl('(^| )no:qn \\w+', condensed_p_o_s)) %>%
  mutate(no_qn = lapply(condensed_p_o_s, no_qn_tag)) %>%
  # Nonsense words, onomatopoeia, and L2 words
  within(no_qn[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", no_qn)] <- "other") %>%
  # One row per instance of no; utterances with multiple 'no's are doubled 
  unnest(no_qn) %>%
  filter(!grepl('^$', no_qn))

# Define order to ensure consistency across graphs
no_qn_counts <- (count(no_qns, no_qn))
order <- (no_qn_counts[order(-no_qn_counts$n),])$no_qn
order <- append(order[order!= "other"], "other")
no_qns$no_qn <- factor(no_qns$no_qn, levels = order)


# FILTER TO TWO WORD UTTERANCES
# no_qns <- no_qns %>%
#   filter(n_tokens_clean ==2)

ggplot() +
  geom_bar(no_qns, mapping = aes(bin, fill = no_qn))+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD \'no (qn)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot() +
  geom_bar(no_qns, mapping = aes(bin, fill = no_qn), position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD \'no (qn)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

# Maybe make one that's just the number of things no combines with per bin

```

```{r child no:co Environment, echo=FALSE}
# No:co Environment
no_co_tag <- function(pos) 
{
  pos_list = unlist(strsplit(pos, " "))
  
  n_list = grep("^no:co$", pos_list)
  
  out = pos_list[n_list+1]
  out = out[!is.na(out)]
  return(out)
}


no_cos <- child_negation %>%
  filter(grepl('(^| )no:co \\w+', condensed_p_o_s)) %>%
  mutate(no_co = lapply(condensed_p_o_s, no_co_tag)) %>%
  # Nonsense words, onomatopoeia, and L2 words
  within(no_co[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", no_co)] <- "other") %>%
  # One row per instance of no; utterances with multiple 'no's are doubled 
  unnest(no_co) %>%
  filter(!grepl('^$', no_co))

# Ensure same order of elements
no_co_counts <- count(no_cos, no_co)
no_co_order <- append(as.character(order), as.character(filter(no_co_counts, !(no_co %in% order))$no_co %>% unique()))
no_cos$no_co <- factor(no_cos$no_co, levels = no_co_order)

# FILTER TO TWO WORD UTTERANCES
# no_cos <- no_cos %>%
#   filter(n_tokens_clean ==2)

ggplot() +
  geom_bar(no_cos, mapping = aes(bin, fill = no_co))+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD \'no (co)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot() +
  geom_bar(no_cos, mapping = aes(bin, fill = no_co), position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD \'no (co)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

# Maybe make one that's just the number of things no combines with per bin

```


```{r parent no:qn Environment, echo=FALSE}

p_no_qns <- parent_negation %>%
  filter(grepl('(^| )no:qn \\w+', condensed_p_o_s)) %>%
  mutate(no_qn = lapply(condensed_p_o_s, no_qn_tag)) %>%
  # Nonsense words, onomatopoeia, and L2 words
  within(no_qn[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", no_qn)] <- "other") %>%
  # One row per instance of no; utterances with multiple 'no's are doubled 
  unnest(no_qn) %>%
  filter(!grepl('^$', no_qn))

# Ensure same order of elements
p_no_qn_counts <- count(p_no_qns, no_qn)
p_no_qn_order <- append(as.character(no_co_order), as.character(filter(p_no_qn_counts, !(no_qn %in% no_co_order))$no_qn %>% unique()))
p_no_qns$no_qn <- factor(p_no_qns$no_qn, levels = p_no_qn_order)

# FILTER TO TWO WORD UTTERANCES
# p_no_cos <- p_no_cos %>%
#   filter(n_tokens_clean ==2)

ggplot() +
  geom_bar(p_no_qns, mapping = aes(bin, fill = no_qn))+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT \'no (qn)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot() +
  geom_bar(p_no_qns, mapping = aes(bin, fill = no_qn), position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT \'no (qn)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

```



```{r parent no:co Environment, echo=FALSE}

p_no_cos <- parent_negation %>%
  filter(grepl('(^| )no:co \\w+', condensed_p_o_s)) %>%
  mutate(no_co = lapply(condensed_p_o_s, no_co_tag)) %>%
  # Nonsense words, onomatopoeia, and L2 words
  within(no_co[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", no_co)] <- "other") %>%
  # One row per instance of no; utterances with multiple 'no's are doubled 
  unnest(no_co) %>%
  filter(!grepl('^$', no_co))

# Ensure same order of elements
p_no_co_counts <- count(p_no_cos, no_co)
p_no_co_order <- append(as.character(order), as.character(filter(p_no_co_counts, !(no_co %in% order))$no_co %>% unique()))
p_no_cos$no_co <- factor(p_no_cos$no_co, levels = p_no_co_order)

# FILTER TO TWO WORD UTTERANCES
# p_no_cos <- p_no_cos %>%
#   filter(n_tokens_clean ==2)

ggplot() +
  geom_bar(p_no_cos, mapping = aes(bin, fill = no_co))+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT \'no (co)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot() +
  geom_bar(p_no_cos, mapping = aes(bin, fill = no_co), position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT \'no (co)\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

```

```{r parent all no Environment, include=FALSE}
# nos_p <- parent_negation %>%
#   # Use to filter age range
#   #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
#   filter(grepl('(^| )no \\w+', condensed_p_o_s)) %>%
#   mutate(no = lapply(condensed_p_o_s, no_tag)) %>%
#   # Nonsense words, onomatopoeia, and L2 words
#   within(no[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", no)] <- "other") %>%
#   # One row per instance of no; utterances with multiple 'no's are doubled 
#   unnest(no) %>%
#   filter(!grepl('^$', no))
# 
# # Create proportion table
# nos_p_prop <- merge(
#   tally(group_by(nos_p, bin)) %>% dplyr::rename(total = n), 
#   dcast(nos_p, bin~no, value.var = "no", fun.aggregate = length), by = "bin")
# # Divide by total to get proportion by bin
# nos_p_prop[,-(1:2)] <- nos_p_prop[,-(1:2)]/nos_p_prop[,2]
# 
# # Prepare for graphing
# nos_p_prop <- nos_p_prop[,-2] %>%
#   melt(id = "bin", value.name = "proportion", variable.name = "PoS")
# 
# # Ensure same order of elements
# order <- append(as.character(no_order), as.character(filter(nos_p_prop, !(PoS %in% no_order))$PoS %>% unique()))
# nos_p_prop$PoS <- factor(nos_p_prop$PoS, levels = order)
# nos_p$no <- factor(nos_p$no, levels = order)
# 
# ggplot() +
#   geom_bar(nos_p, mapping = aes(bin, fill = no))+
#   xlab("Age Bin")+
#   ylab("Number of Instances")+
#   ggtitle("PARENT \'No\' Environment")+
#   theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
#   theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
#   labs(fill = "Part of Speech") +
#   scale_fill_manual(values=as.vector(alphabet2()))
# 
# ggplot() +
#   geom_bar(nos_p_prop, mapping = aes(bin, proportion, fill = PoS), stat ="identity")+
#   xlab("Age Bin")+
#   ylab("Proportion of Instances")+
#   ggtitle("PARENT \'No\' Environment")+
#   theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
#   theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
#   labs(fill = "Part of Speech") +
#   scale_fill_manual(values=as.vector(alphabet2()))

```

```{r child not Environment, echo=FALSE}

not_tag <- function(pos) 
{
  pos_list = unlist(strsplit(pos, " "))
  
  n_list = grep("^not$", pos_list)
  
  out = pos_list[n_list+1]
  out = out[!is.na(out)]
  return(out)
}

nots <- child_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )not \\w+', condensed_p_o_s)) %>%
  mutate(not = lapply(condensed_p_o_s, not_tag)) %>%
  # notnsense words, onotmatopoeia, and L2 words
  within(not[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", not)] <- "other") %>%
  # One row per instance of not; utterances with multiple 'not's are doubled 
  unnest(not) %>%
  filter(!grepl('^$', not))

# Ensure same order of elements
not_counts <- count(nots, not)
not_order <- append(as.character(order), as.character(filter(not_counts, !(not %in% order))$not %>% unique()))
nots$not <- factor(nots$not, levels = not_order)


ggplot(nots, aes(bin, fill = not)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD \'not\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(nots, aes(bin, fill = not)) +
  geom_bar(position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD \'not\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))



```

```{r parent not Environment, echo=FALSE}
nots_p <- parent_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )not \\w+', condensed_p_o_s)) %>%
  mutate(not = lapply(condensed_p_o_s, not_tag)) %>%
  # notnsense words, onotmatopoeia, and L2 words
  within(not[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", not)] <- "other") %>%
  # One row per instance of not; utterances with multiple 'not's are doubled 
  unnest(not) %>%
  filter(!grepl('^$', not))


# Ensure same order of elements
not_counts_p <- count(nots_p, not)
not_order_p <- append(as.character(not_order), as.character(filter(not_counts_p, !(not %in% not_order))$not %>% unique()))
nots_p$not <- factor(nots_p$not, levels = not_order_p)


ggplot(nots_p, aes(bin, fill = not)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT \'not\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(nots_p, aes(bin, fill = not)) +
  geom_bar(position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT \'not\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

```

```{r child mod Environment, echo=FALSE}

mod_tag <- function(pos) 
{
  pos_list = unlist(strsplit(pos, " "))
  
  n_list = grep("^mod$", pos_list)
  
  out = pos_list[n_list+1]
  out = out[!is.na(out)]
  return(out)
}

mods <- child_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )mod \\w+', condensed_p_o_s)) %>%
  mutate(mod = lapply(condensed_p_o_s, mod_tag)) %>%
  # modnsense words, omodmatopoeia, and L2 words
  within(mod[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", mod)] <- "other") %>%
  # One row per instance of mod; utterances with multiple 'mod's are doubled 
  unnest(mod) %>%
  filter(!grepl('^$', mod))

# Ensure same order of elements
mod_counts <- count(mods, mod)
mod_order <- append(as.character(order), as.character(filter(mod_counts, !(mod %in% order))$mod %>% unique()))
mods$mod <- factor(mods$mod, levels = mod_order)

ggplot(mods, aes(bin, fill = mod)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD \'mod\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(mods, aes(bin, fill = mod)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD \'mod\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))


```

```{r parent mod Environment, echo=FALSE}
mods_p <- parent_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )mod \\w+', condensed_p_o_s)) %>%
  mutate(mod = lapply(condensed_p_o_s, mod_tag)) %>%
  # modnsense words, omodmatopoeia, and L2 words
  within(mod[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", mod)] <- "other") %>%
  # One row per instance of mod; utterances with multiple 'mod's are doubled 
  unnest(mod) %>%
  filter(!grepl('^$', mod))

# Ensure same order of elements
mod_counts_p <- count(mods_p, mod)
mod_order_p <- append(as.character(mod_order), as.character(filter(mod_counts_p, !(mod %in% mod_order))$mod %>% unique()))
mods_p$mod <- factor(mods_p$mod, levels = mod_order_p)

ggplot(mods_p, aes(bin, fill = mod)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT \'mod\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(mods_p, aes(bin, fill = mod)) +
  geom_bar(position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT \'mod\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))
```

```{r child nt Environment, echo=FALSE}

# Finds successor of n't word; doesn't handle cases where there are multiple
nt_tag <- function(gloss, pos)
{
  gloss_list = strsplit(gloss, " ")[[1]]
  pos_list = strsplit(pos, " ")[[1]]
  result = list()
  for (g in 1:length(gloss_list)) {
    if (grepl('[a-z]+n\'t', gloss_list[g])){
      result =append(unlist(result), pos_list[g+1])
    }
  }
  result = result[!is.na(result)]
  return(result)
}


nts <- child_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )[a-z]+n\'t \\w+', clean_utterances)) %>%
  mutate(nt = mapply(nt_tag, clean_utterances, condensed_p_o_s)) %>%
  # ntnsense words, ontmatopoeia, and L2 words
  within(nt[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", nt)] <- "other") %>%
  # One row per instance of nt; utterances with multiple 'nt's are doubled 
  unnest(nt) %>%
  filter(!grepl('^$', nt))

# Ensure same order of elements
nt_counts <- count(nts, nt)
nt_order <- append(as.character(order), as.character(filter(nt_counts, !(nt %in% order))$nt %>% unique()))
nts$nt <- factor(nts$nt, levels = nt_order)

ggplot(nts, aes(bin, fill = nt)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("CHILD \'nt\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(nts, aes(bin, fill = nt)) +
  geom_bar(position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("CHILD \'nt\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

```

```{r parent nt Environment, echo=FALSE}

nts_p <- parent_negation %>%
  # Use to filter age range
  #filter(bin %in% unlist(lapply(1:23, bin_age)))%>%
  filter(grepl('(^| )[a-z]+n\'t \\w+', clean_utterances)) %>%
  mutate(nt = mapply(nt_tag, clean_utterances, condensed_p_o_s)) %>%
  # ntnsense words, ontmatopoeia, and L2 words
  within(nt[grepl("chi|unk|bab|sing|on|uni|wplay|dia|L2|int|fam|neo", nt)] <- "other") %>%
  # One row per instance of nt; utterances with multiple 'nt's are doubled 
  unnest(nt) %>%
  filter(!grepl('^$', nt))

# Ensure same order of elements_p
nt_counts_p <- count(nts_p, nt)
nt_order_p <- append(as.character(nt_order), as.character(filter(nt_counts_p, !(nt %in% nt_order))$nt %>% unique()))
nts_p$nt <- factor(nts_p$nt, levels = nt_order_p)

ggplot(nts_p, aes(bin, fill = nt)) +
  geom_bar()+
  xlab("Age Bin")+
  ylab("Number of Instances")+
  ggtitle("PARENT \'nt\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

ggplot(nts_p, aes(bin, fill = nt)) +
  geom_bar(position = "fill")+
  xlab("Age Bin")+
  ylab("Proportion of Instances")+
  ggtitle("PARENT \'nt\' Environment")+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1), plot.title = element_text(hjust = 0.5))+
  theme(legend.key=element_blank(), legend.key.size=unit(12,"point"))+
  labs(fill = "Part of Speech") +
  scale_fill_manual(values=as.vector(alphabet2()))

```

```{r Participants, echo=FALSE}
# Participant information

# 173
child_negation$speaker_id %>% unique() %>% length()

speaker_counts <- child_negation %>% count(speaker_id)

# Proportion of total (0, 24) utterances that include negation by age bin (maybe split bar graph?)
#all_utterances
# Proportion of children in each age bin producing negation
# Proportion of utterances that include negation by child (?)
```


